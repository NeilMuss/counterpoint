# Counterpoint2

Counterpoint2 is a deterministic, vector‑first Noordzij stroke engine. It is built from first principles and is **not** coupled to the legacy engine. The output is generated by a boundary‑soup + deterministic ring trace (no rasterization, no polygon union).

## Pipeline (current implementation)
1) `SkeletonPath` (invariant geometry)
2) Global‑t parameterization (arc‑length across segments)
3) Adaptive sampling (default; no fixed sampling in normal use)
4) Rail generation:
   - left/right offsets are **center ± vRot * widthLeft/widthRight**
   - **not** rectangle corner selection
5) Boundary soup (segments tagged with provenance)
6) Ring construction (ordered loop)
7) SVG outline + deterministic debug overlays

## What’s fixed / stable
- **J cut‑off / teleport chord** traced to diagonal nib corner selection; fixed by cross‑axis offsets.
- **Adaptive sampling** now includes keyframe times and rail‑aware refinement (removes faceting at sharp param ramps).
- **Param interpolation** uses cubic Hermite with monotone limiter by default for widths:
  - C¹ continuity by default
  - optional knot semantics per keyframe: `smooth | cusp | hold | snap`
  - `interpToNext.alpha` is **tangent scale** (not time warp)

## Debug tooling (CLI)
- `--view compare` / `--view compareAll`
  - strict layer order: reference fill → ink fill → reference outline → debug overlays
- `--debug-params` probe logging (C/T/N, vRot, widths, theta, offset)
- `--view keyframes` markers for keyframe times
- `--view paramsPlot` mini‑graphs of widthLeft/widthRight (and knot types)
- ring diagnostics: `ringSpine`, `ringJump`, `traceJumpStep`
- sampling diagnostics: `samplingWhy` and solo mode (`--debug-solo-why`)

## Where we are now
- **Big Caslon J** is typographically convincing.
- Remaining mismatch is **terminal vocabulary** (elliptical/ball terminal). This will be implemented as a first‑class appendage shape rather than hacked via width.
- UI editing is the current bottleneck; CLI is sufficient for engine validation.

## Next up
- **Big Caslon “e”**: self‑overlap correctness, counter subtraction, and lower‑lip rounding vocabulary.

## Example commands
Render J with comparison overlay:
```
swift run cp2-cli Fixtures/glyphs/J.v0.json --out out/J.svg --view compare
```

Render e fixture (scaffold):
```
swift run cp2-cli Fixtures/glyphs/e.v0.json --out out/e.svg --view compare
```

Note: counters in `e.v0.json` are currently **debug‑only overlays** (subtraction is scaffolded but not yet implemented).
